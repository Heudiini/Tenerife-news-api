<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tenerife News API</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="header">
      <h1>Tenerife News From Various Sources</h1>
      <div class="demo">Powered by My Custom API üòä</div>
      <div id="last-updated" class="last-updated"></div>
      <!-- Aikaleima -->
    </header>

    <main>
      <div id="loading-message" style="display: none">Fetching Data...</div>
      <div id="news-container"></div>

      <script>
        const apiUrl = "http://localhost:8000/news"; // API URL
        const updateInterval = 60000; // 60 sekuntia

        const fetchNews = () => {
          document.getElementById("loading-message").style.display = "block"; // N√§yt√§ latausviesti

          fetch(apiUrl)
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((newsData) => {
              // J√§rjestet√§√§n uutiset
              const sortedNewsData = newsData.sort((a, b) => {
                const aScore =
                  (a.image ? 1 : 0) + (a.title.length >= 20 ? 1 : 0);
                const bScore =
                  (b.image ? 1 : 0) + (b.title.length >= 20 ? 1 : 0);
                return bScore - aScore; // Suurempi pistem√§√§r√§ ensin
              });

              let newsHTML = "";

              if (sortedNewsData.length > 0) {
                sortedNewsData.forEach(function (item) {
                  const title = item.title || "No Title Available";
                  const url = item.url || "#";
                  let image = item.image || "";

                  // Tarkista, ett√§ kuva on saatavilla ja n√§kyviss√§
                  if (image && !image.startsWith("http")) {
                    image = ""; // Tyhjenn√§ kuva, jos se ei ole oikein
                  }

                  newsHTML += `<div class="news-item">
                                    ${
                                      image
                                        ? `<img src="${image}" alt="${title} image" />`
                                        : ""
                                    }
                                    <h5>${title}</h5>
                                    <a href="${url}" target="_blank">Read More</a>
                                </div>`;
                });
              } else {
                newsHTML = "<p>No news articles found.</p>";
              }

              document.getElementById("news-container").innerHTML = newsHTML;

              // Aikaleiman p√§ivitys
              const now = new Date();
              const timestamp = now.toLocaleString(); // Muotoillaan aikaleima
              document.getElementById(
                "last-updated"
              ).innerText = `Last updated: ${timestamp}`;
            })
            .catch((error) => {
              console.error("Error fetching news:", error);
              document.getElementById("news-container").innerHTML =
                "Error fetching news. Please try again later.";
            })
            .finally(() => {
              document.getElementById("loading-message").style.display = "none"; // Piilota latausviesti
            });
        };

        // Hae uutiset heti ensimm√§isen kerran
        fetchNews();
        // Aseta s√§√§nn√∂llinen p√§ivitys
        setInterval(fetchNews, updateInterval);
      </script>
    </main>

    <footer>
      ¬© 2022 updated 2024 Coded by
      <a target="_blank" href="https://heidimorsky.netlify.app/">Heudiini</a
      ><br />
      <a href="https://github.com/Heudiini/rapid-api-project"
        >Source Code on Github</a
      >
    </footer>
  </body>
</html>
